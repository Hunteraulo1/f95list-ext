(function(){"use strict";const e=typeof browser>"u"?chrome:browser;e.runtime.onInstalled.addListener(async()=>{const{f95list_ext_integrate:t}=await e.storage.local.get(["f95list_ext_integrate"]);t===void 0&&await e.storage.local.set({f95list_ext_integrate:!0}),await c(),await o()}),e.runtime.onStartup.addListener(async()=>{await c(),await o()});const w=async()=>{const{f95list_ext_data:t}=await e.storage.local.get(["f95list_ext_data"]);if(!t||t.updates.length===0)throw new Error("no data");return t.updates},o=async()=>{const t=typeof browser>"u"?chrome.action:browser.browserAction,a=await w(),{f95list_ext_badge:s}=await e.storage.local.get(["f95list_ext_badge"]);let r=0;a==null||a.every(n=>!s||n.date<s[0].date?!1:(r+=n.names.length,!0)),s==null||s.map(n=>{r-=n.names.length});const l=r===0?"":r.toString();await t.setBadgeBackgroundColor({color:"#CC0000"}),await t.setBadgeText({text:l})},f=async()=>{try{const t=await w(),a=[t[0]];t[0].date===t[1].date&&a.push(t[1]),await e.storage.local.set({f95list_ext_badge:a}),await o()}catch(t){console.error(t)}};let i=!1;const g=t=>new Promise(a=>setTimeout(a,t)),c=async()=>{for(;i;)await g(1e3);const{f95list_ext_data:t}=await e.storage.local.get(["f95list_ext_data"]);if(i)return;i=!0;const a=new Date().getTime(),{f95list_ext_time:s}=await e.storage.local.get(["f95list_ext_time"]);if(t&&s&&a<s){i=!1;return}await e.storage.local.set({f95list_ext_time:a+1e3*60*60*2}),await e.storage.local.set({f95list_ext_data:await _()}),await o(),i=!1};e.runtime.onMessage.addListener((t,a,s)=>((async()=>{await c();const{f95list_ext_data:r}=await e.storage.local.get(["f95list_ext_data"]);switch(t){case"f95list-script":{const{f95list_ext_integrate:l}=await e.storage.local.get(["f95list_ext_integrate"]);if(!l)throw new Error("no integrate");await s(r.games);break}case"f95list-ext":await s(r);break;case"f95list-badge":await f();break;case"f95list-integrate_true":await e.storage.local.set({f95list_ext_integrate:!0});break;case"f95list-integrate_false":await e.storage.local.set({f95list_ext_integrate:!1});break}})(),!0));const _=async()=>{try{console.info("ðŸš€ ~ query: ~ fetch");const a=await(await fetch("https://script.google.com/macros/s/AKfycbybvrFy6B2L7rkLWJnrwRHhP0F6Sv0uk6V9zUTZibwEzUjKXf-abOK_N6jUhqFPs9US/exec")).json();if(!(a!=null&&a.data))throw new Error("fetch not data");return a.data}catch(t){console.error(t),await e.storage.local.set({f95list_ext_time:0}),i=!1}}})();
